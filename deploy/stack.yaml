version: '3.8'
networks:
  agents:
    driver: overlay
    driver_opts:
      encrypted: 'true'
secrets:
  openclaw_gateway_token:
    external: true
volumes:
  hermes-data: null
services:
  lily:
    image: openclaw-friend:latest
    networks:
    - agents
    ports:
    - 18790:18790
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 10
        window: 120s
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    environment:
    - OPENCLAW_GATEWAY_TOKEN=password
    - FORGE_URL=http://warren_promptforge:8083
    - SOUL_SLUG=lily
    - GEMINI_API_KEY=AIzaSyCMnoSY8R0Pn9Y6AWaJuJmi8ITXM8x5H3A
    - OPENAI_API_KEY=unused
    - OPENCLAW_GATEWAY_PORT=18790
    - OPENCLAW_MODEL=openai-codex/gpt-5.3-codex
    - NATS_URL=nats://warren_hermes:4222
    - AGENT_ID=lily
    - OPENCLAW_PREFER_PNPM=1
    - NODE_ENV=production
    volumes:
    - /home/mike/openclaw-friend/friend-openclaw-data:/home/node/.openclaw
    - /home/mike/shared-bin:/usr/local/shared-bin:ro
    command:
    - /bin/sh
    - /home/node/.openclaw/pull-soul-entrypoint.sh
  dutybound-mc:
    image: dutybound-mc:latest
    networks:
    - agents
    ports:
    - 8081:8081
    deploy:
      replicas: 0
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 10
        window: 120s
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '0.5'
          memory: 1G
    secrets:
    - openclaw_gateway_token
    volumes:
    - /home/mike/MissionControl:/opt/mc
  hermes:
    image: nats:latest
    networks:
    - agents
    ports:
    - 4222:4222
    - 8222:8222
    command:
    - --jetstream
    - --store_dir
    - /data
    - --http_port
    - '8222'
    volumes:
    - hermes-data:/data
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 10
        window: 120s
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
  promptforge:
    image: promptforge:latest
    networks:
    - agents
    ports:
    - 8083:8083
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 5
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
    environment:
    - SUPABASE_URL=https://uaubofpmokvumbqpeymz.supabase.co
    - SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhdWJvZnBtb2t2dW1icXBleW16Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MDg0OTMyNywiZXhwIjoyMDg2NDI1MzI3fQ.vpS4LvCi80RZlfxZStGKL8Oti-0qo33eoC5-7RA-YAk
    - SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhdWJvZnBtb2t2dW1icXBleW16Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MDg0OTMyNywiZXhwIjoyMDg2NDI1MzI3fQ.vpS4LvCi80RZlfxZStGKL8Oti-0qo33eoC5-7RA-YAk
    - PROMPT_FORGE_API_KEY=forge-api-868f36e0
    - NATS_URL=nats://warren_hermes:4222
  celebrimbor:
    image: openclaw-friend:latest
    networks:
    - agents
    ports:
    - 18791:18791
    deploy:
      replicas: 0
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 5
        window: 120s
      resources:
        limits:
          cpus: '1.0'
          memory: 2G
    environment:
    - OPENCLAW_GATEWAY_TOKEN=celebrimbor-forge-token
    - OPENCLAW_MODEL=anthropic/claude-sonnet-4-20250514
    - ALEXANDRIA_URL=http://192.168.1.218:8500
    - AGENT_ID=celebrimbor
    - NATS_URL=nats://warren_hermes:4222
    - OPENCLAW_GATEWAY_PORT=18791
    - NODE_ENV=production
    volumes:
    - /home/mike/celebrimbor-data:/home/node/.openclaw
    - /home/mike/shared-bin:/usr/local/shared-bin:ro
    command:
    - /bin/sh
    - /home/node/.openclaw/pull-auth-entrypoint.sh
  alexandria:
    image: alexandria:latest
    networks:
    - agents
    ports:
    - target: 8500
      published: 8500
      protocol: tcp
      mode: host
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 5
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
    environment:
    - SUPABASE_URL=https://uaubofpmokvumbqpeymz.supabase.co
    - SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhdWJvZnBtb2t2dW1icXBleW16Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MDg0OTMyNywiZXhwIjoyMDg2NDI1MzI3fQ.vpS4LvCi80RZlfxZStGKL8Oti-0qo33eoC5-7RA-YAk
    - NATS_URL=nats://warren_hermes:4222
    - ENCRYPTION_KEY=myU3s2rP9Z4u6RM-IeL8kCoLkDOEdTJdfaCYU56dfhs=
    - EMBEDDING_BACKEND=local
    - EMBEDDING_SIDECAR_URL=http://warren_alexandria_embeddings:8501
    - DATABASE_URL=postgresql://postgres.uaubofpmokvumbqpeymz:TnNHutUQb4eHfX6g@aws-1-eu-central-1.pooler.supabase.com:5432/postgres
  alexandria_embeddings:
    image: alexandria-embeddings:latest
    networks:
    - agents
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 5
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
  dispatch:
    image: dispatch:latest
    networks:
    - agents
    ports:
    - 8600:8600
    - 8601:8601
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 10
        window: 120s
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
    environment:
    - DISPATCH_PORT=8600
    - DISPATCH_METRICS_PORT=8601
    - DISPATCH_ADMIN_TOKEN=dispatch-admin-868f36e0
    - DISPATCH_DATABASE_URL=postgresql://postgres.uaubofpmokvumbqpeymz:TnNHutUQb4eHfX6g@aws-1-eu-central-1.pooler.supabase.com:5432/postgres
    - DISPATCH_HERMES_URL=nats://warren_hermes:4222
    - DISPATCH_WARREN_URL=http://192.168.1.218:9090
    - DISPATCH_WARREN_TOKEN=warren-admin-868f36e0
    - DISPATCH_FORGE_URL=http://warren_promptforge:8083
    - DISPATCH_ALEXANDRIA_URL=http://warren_alexandria:8500
    - DISPATCH_TICK_INTERVAL_MS=5000
  scout:
    image: openclaw-friend:latest
    networks:
    - agents
    ports:
    - 18792:18792
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 10
        window: 120s
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M
    environment:
    - OPENCLAW_GATEWAY_TOKEN=scout-gateway-868f36e0
    - FORGE_URL=http://warren_promptforge:8083
    - SOUL_SLUG=scout
    - ALEXANDRIA_URL=http://warren_alexandria:8500
    - OPENCLAW_GATEWAY_PORT=18792
    - OPENCLAW_MODEL=anthropic/claude-sonnet-4-20250514
    - NATS_URL=nats://warren_hermes:4222
    - AGENT_ID=scout
    - NODE_ENV=production
    volumes:
    - /home/mike/scout-data:/home/node/.openclaw
    - /home/mike/shared-bin:/usr/local/shared-bin:ro
    command:
    - /bin/sh
    - /home/node/.openclaw/pull-soul-entrypoint.sh
